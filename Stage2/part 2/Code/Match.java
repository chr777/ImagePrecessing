import ij.ImagePlus;
import ij.process.ImageProcessor;
import ij.plugin.filter.PlugInFilter;
import java.awt.Color;

public class Match implements PlugInFilter {

	public int setup(String arg, ImagePlus img) {
			return DOES_RGB;
		}

		public void run(ImageProcessor ip) {
			Color color;
			double[] Green = {
					0.0, 
					0.0, 
					1.0683760683760684, 
					1.0683760683760684, 
					1.0683760683760684, 
					8.547008547008547, 
					4.0598290598290, 
					0.00202991452991453, 
					0.005170940170940171, 
					0.010202991452991453, 
					0.01799145299145299, 
					0.027991452991452993, 
					0.04049145299145299, 
					0.054893162393162394, 
					0.07019230769230769, 
					0.08587606837606837, 
					0.10148504273504273, 
					0.1152991452991453, 
					0.12941239316239317, 
					0.1429273504273504, 
					0.15538461538461537, 
					0.16726495726495727, 
					0.1782905982905983, 
					0.18865384615384614, 
					0.19762820512820511, 
					0.20625, 
					0.21377136752136752, 
					0.22025641025641027, 
					0.2259188034188034, 
					0.23135683760683762, 
					0.2364102564102564, 
					0.2413034188034188, 
					0.24598290598290598, 
					0.25017094017094016, 
					0.25463675213675213, 
					0.2598076923076923, 
					0.26485042735042735, 
					0.27006410256410257, 
					0.27552350427350425, 
					0.2807264957264957, 
					0.285982905982906, 
					0.2917200854700855, 
					0.29730769230769233, 
					0.30252136752136755, 
					0.30801282051282053, 
					0.31303418803418803, 
					0.31846153846153846, 
					0.324241452991453, 
					0.3295940170940171, 
					0.334284188034188, 
					0.33949786324786324, 
					0.3441880341880342, 
					0.3486217948717949, 
					0.35340811965811963, 
					0.3580982905982906, 
					0.36277777777777775, 
					0.3673397435897436, 
					0.37183760683760686, 
					0.3761645299145299, 
					0.3806837606837607, 
					0.38587606837606836, 
					0.3910470085470085, 
					0.39611111111111114, 
					0.4016025641025641, 
					0.4069017094017094, 
					0.4129059829059829, 
					0.41873931623931626, 
					0.42480769230769233, 
					0.4308440170940171, 
					0.43743589743589745, 
					0.44379273504273503, 
					0.45001068376068376, 
					0.45610042735042733, 
					0.4619871794871795, 
					0.46759615384615383, 
					0.4733547008547008, 
					0.47925213675213674, 
					0.48460470085470086, 
					0.4900534188034188, 
					0.4954273504273504, 
					0.5012606837606838, 
					0.5076282051282052, 
					0.5144230769230769, 
					0.5218910256410256, 
					0.5301282051282051, 
					0.5389957264957265, 
					0.5487179487179488, 
					0.5580555555555555, 
					0.5678418803418803, 
					0.5772435897435897, 
					0.586474358974359, 
					0.5956730769230769, 
					0.6053846153846154, 
					0.6146260683760684, 
					0.6229166666666667, 
					0.6312927350427351, 
					0.6387606837606837, 
					0.6452136752136752, 
					0.6518803418803418, 
					0.6584829059829059, 
					0.6657692307692308, 
					0.6726282051282051, 
					0.6787606837606838, 
					0.6851602564102565, 
					0.6913461538461538, 
					0.6972649572649573, 
					0.7035470085470086, 
					0.7101068376068376, 
					0.7163782051282052, 
					0.723215811965812, 
					0.7306623931623931, 
					0.7383760683760684, 
					0.7459508547008546, 
					0.753792735042735, 
					0.7614529914529915, 
					0.7692841880341881, 
					0.7762179487179487, 
					0.782457264957265, 
					0.787457264957265, 
					0.7914209401709402, 
					0.794284188034188, 
					0.7962606837606837, 
					0.7986538461538462, 
					0.8008653846153846, 
					0.8026602564102564, 
					0.8043482905982906, 
					0.8060897435897436, 
					0.8078418803418803, 
					0.8096047008547008, 
					0.8111645299145299, 
					0.8123611111111111, 
					0.8136324786324787, 
					0.8147435897435897, 
					0.8160363247863248, 
					0.8172115384615385, 
					0.8185470085470086, 
					0.8195619658119658, 
					0.8204273504273504, 
					0.8213782051282051, 
					0.8223824786324786, 
					0.8233974358974359, 
					0.8243803418803419, 
					0.8251602564102564, 
					0.8261324786324786, 
					0.8268696581196581, 
					0.8276709401709401, 
					0.8283653846153847, 
					0.8292307692307692, 
					0.8298931623931624, 
					0.8306837606837607, 
					0.8315384615384616, 
					0.8326175213675213, 
					0.8336004273504274, 
					0.8348931623931624, 
					0.8362393162393162, 
					0.8377029914529914, 
					0.8389102564102564, 
					0.8405982905982906, 
					0.8422863247863248, 
					0.8442307692307692, 
					0.8466559829059829, 
					0.8497863247863248, 
					0.853215811965812, 
					0.8564423076923077, 
					0.8596474358974359, 
					0.8633119658119658, 
					0.8676282051282052, 
					0.8717628205128205, 
					0.8763354700854701, 
					0.8808974358974359, 
					0.8852884615384615, 
					0.8897222222222222, 
					0.8944337606837607, 
					0.8989529914529915, 
					0.9031837606837607, 
					0.9076602564102564, 
					0.9117521367521367, 
					0.9156196581196581, 
					0.9192307692307692, 
					0.9228311965811966, 
					0.9260683760683761, 
					0.9291773504273504, 
					0.9323824786324786, 
					0.936698717948718, 
					0.9427350427350427, 
					0.9502136752136752, 
					0.9583547008547009, 
					0.9658119658119658, 
					0.973258547008547, 
					0.9811965811965812, 
					0.9887393162393162, 
					0.9943162393162394, 
					0.9975641025641026, 
					0.9990918803418803, 
					0.9996367521367522, 
					0.9998611111111111, 
					0.9999465811965812, 
					0.9999893162393162, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 

			};
			double[] Red = {
					0.0, 
					0.0, 
					0.0, 
					0.0, 
					0.0, 
					3.205128205128205E-5, 
					3.525641025641026E-4, 
					0.001965811965811966, 
					0.004925213675213675, 
					0.009594017094017094, 
					0.016923076923076923, 
					0.02577991452991453, 
					0.03584401709401709, 
					0.04705128205128205, 
					0.059465811965811965, 
					0.07168803418803418, 
					0.08259615384615385, 
					0.09272435897435898, 
					0.1027991452991453, 
					0.11300213675213676, 
					0.12299145299145299, 
					0.1323931623931624, 
					0.14182692307692307, 
					0.1503525641025641, 
					0.1585363247863248, 
					0.16642094017094017, 
					0.17365384615384616, 
					0.18072649572649574, 
					0.1861965811965812, 
					0.1909508547008547, 
					0.1950854700854701, 
					0.19903846153846153, 
					0.2025320512820513, 
					0.20586538461538462, 
					0.20903846153846153, 
					0.21240384615384617, 
					0.2152991452991453, 
					0.2176602564102564, 
					0.21996794871794872, 
					0.22230769230769232, 
					0.22442307692307692, 
					0.22641025641025642, 
					0.2283119658119658, 
					0.2302991452991453, 
					0.23202991452991453, 
					0.23342948717948717, 
					0.2350534188034188, 
					0.23686965811965813, 
					0.23846153846153847, 
					0.2401923076923077, 
					0.24175213675213675, 
					0.24388888888888888, 
					0.24613247863247864, 
					0.24847222222222223, 
					0.25099358974358976, 
					0.25351495726495726, 
					0.2564102564102564, 
					0.2591773504273504, 
					0.26224358974358974, 
					0.26580128205128206, 
					0.2693910256410256, 
					0.2730448717948718, 
					0.27666666666666667, 
					0.27992521367521367, 
					0.2830448717948718, 
					0.2861431623931624, 
					0.28967948717948716, 
					0.29338675213675214, 
					0.29678418803418805, 
					0.3000854700854701, 
					0.30362179487179486, 
					0.30680555555555555, 
					0.3104273504273504, 
					0.31398504273504274, 
					0.31754273504273506, 
					0.32076923076923075, 
					0.3241880341880342, 
					0.3276495726495727, 
					0.330982905982906, 
					0.33413461538461536, 
					0.3370619658119658, 
					0.34021367521367524, 
					0.3434294871794872, 
					0.346517094017094, 
					0.34983974358974357, 
					0.35330128205128203, 
					0.3568482905982906, 
					0.3605555555555556, 
					0.3641559829059829, 
					0.3673717948717949, 
					0.3707692307692308, 
					0.3742628205128205, 
					0.3774145299145299, 
					0.3806303418803419, 
					0.3840811965811966, 
					0.38754273504273506, 
					0.39121794871794874, 
					0.39487179487179486, 
					0.3989102564102564, 
					0.40278846153846154, 
					0.4070619658119658, 
					0.41160256410256413, 
					0.4163034188034188, 
					0.421474358974359, 
					0.4271153846153846, 
					0.4327991452991453, 
					0.43862179487179487, 
					0.44504273504273506, 
					0.45134615384615384, 
					0.4583119658119658, 
					0.46510683760683763, 
					0.4719871794871795, 
					0.4791025641025641, 
					0.4865491452991453, 
					0.4934188034188034, 
					0.5008760683760684, 
					0.507991452991453, 
					0.5152243589743589, 
					0.5228205128205128, 
					0.5309615384615385, 
					0.5389102564102564, 
					0.5471688034188035, 
					0.5553739316239317, 
					0.5636431623931624, 
					0.5724252136752137, 
					0.5800213675213676, 
					0.5875106837606837, 
					0.5944337606837606, 
					0.6019978632478632, 
					0.6095085470085471, 
					0.6174038461538461, 
					0.6256089743589743, 
					0.6338782051282051, 
					0.6419658119658119, 
					0.6501388888888889, 
					0.6579059829059829, 
					0.6658333333333334, 
					0.6737286324786325, 
					0.6808440170940171, 
					0.6879380341880342, 
					0.6947542735042735, 
					0.7017735042735043, 
					0.7086431623931624, 
					0.7151602564102564, 
					0.72125, 
					0.7278846153846154, 
					0.7348504273504274, 
					0.7425641025641025, 
					0.7499358974358974, 
					0.7585897435897436, 
					0.7680769230769231, 
					0.7785897435897436, 
					0.7891773504273504, 
					0.7989423076923077, 
					0.8086111111111111, 
					0.818258547008547, 
					0.8277777777777777, 
					0.8373931623931624, 
					0.8465277777777778, 
					0.8551602564102564, 
					0.8631089743589744, 
					0.8699038461538462, 
					0.8758760683760684, 
					0.8818803418803419, 
					0.8872435897435897, 
					0.8922435897435897, 
					0.8964209401709402, 
					0.9006944444444445, 
					0.9047222222222222, 
					0.9082371794871795, 
					0.9121047008547009, 
					0.9156623931623932, 
					0.9192094017094017, 
					0.9222542735042735, 
					0.9253418803418804, 
					0.9286217948717949, 
					0.9322435897435898, 
					0.9361965811965812, 
					0.9413782051282051, 
					0.9473183760683761, 
					0.9538995726495727, 
					0.9609188034188034, 
					0.9671260683760684, 
					0.9724252136752137, 
					0.978258547008547, 
					0.9851388888888889, 
					0.9916025641025641, 
					0.9961111111111111, 
					0.9984401709401709, 
					0.9993803418803419, 
					0.999775641025641, 
					0.9999358974358974, 
					0.9999786324786325, 
					0.9999893162393162, 
					0.9999893162393162, 
					0.9999893162393162, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0,

			};
			double[] Blue = {0.0, 
					1.0683760683760684, 
					4.2735042735042735, 
					1.7094017094017094, 
					7.158119658119658, 
					0.0025854700854700853, 
					0.0069123931623931625, 
					0.01454059829059829, 
					0.025683760683760683, 
					0.03982905982905983, 
					0.055822649572649576, 
					0.07137820512820513, 
					0.08736111111111111, 
					0.10355769230769231, 
					0.11881410256410256, 
					0.13289529914529916, 
					0.14660256410256411, 
					0.15903846153846155, 
					0.1711431623931624, 
					0.18237179487179486, 
					0.1922863247863248, 
					0.2017948717948718, 
					0.21202991452991454, 
					0.2225534188034188, 
					0.2341880341880342, 
					0.2450534188034188, 
					0.2555769230769231, 
					0.2661004273504273, 
					0.2754380341880342, 
					0.2849786324786325, 
					0.29351495726495724, 
					0.3020299145299145, 
					0.3103418803418803, 
					0.3185576923076923, 
					0.3269444444444444, 
					0.3343162393162393, 
					0.342232905982906, 
					0.3490918803418803, 
					0.3561645299145299, 
					0.3635576923076923, 
					0.37135683760683763, 
					0.37965811965811963, 
					0.3883653846153846, 
					0.3973824786324786, 
					0.40542735042735045, 
					0.41291666666666665, 
					0.4208974358974359, 
					0.4283119658119658, 
					0.43567307692307694, 
					0.4435576923076923, 
					0.45103632478632477, 
					0.4593482905982906, 
					0.4666773504273504, 
					0.47481837606837607, 
					0.4838782051282051, 
					0.49189102564102566, 
					0.4999465811965812, 
					0.5082478632478632, 
					0.5162713675213675, 
					0.525, 
					0.534017094017094, 
					0.5431623931623931, 
					0.5526388888888889, 
					0.5615277777777777, 
					0.5705555555555556, 
					0.5801282051282052, 
					0.5881517094017094, 
					0.5958440170940171, 
					0.6031196581196581, 
					0.6101709401709402, 
					0.6172649572649572, 
					0.6235149572649573, 
					0.6297863247863248, 
					0.6355876068376068, 
					0.6413888888888889, 
					0.6473290598290599, 
					0.6534615384615384, 
					0.6595405982905983, 
					0.6651282051282051, 
					0.6711965811965812, 
					0.6770192307692308, 
					0.6830021367521367, 
					0.6889423076923077, 
					0.6945619658119658, 
					0.7005876068376068, 
					0.7075, 
					0.7151388888888889, 
					0.7233226495726496, 
					0.7321474358974359, 
					0.7402136752136752, 
					0.7480021367521368, 
					0.7548824786324786, 
					0.760534188034188, 
					0.7655555555555555, 
					0.7699145299145299, 
					0.7735576923076923, 
					0.7768589743589743, 
					0.7794551282051282, 
					0.7817307692307692, 
					0.783568376068376, 
					0.7850854700854701, 
					0.7860683760683761, 
					0.7871581196581197, 
					0.7878739316239316, 
					0.7883547008547008, 
					0.7889850427350428, 
					0.7894017094017094, 
					0.7898504273504273, 
					0.7902029914529914, 
					0.790673076923077, 
					0.7909615384615385, 
					0.7913888888888889, 
					0.7917628205128205, 
					0.7921153846153847, 
					0.7924893162393163, 
					0.7929594017094017, 
					0.793707264957265, 
					0.7943803418803419, 
					0.7952350427350428, 
					0.7963247863247863, 
					0.7974145299145299, 
					0.7988141025641026, 
					0.8002777777777778, 
					0.8013461538461538, 
					0.8025106837606838, 
					0.8037286324786325, 
					0.8050320512820512, 
					0.806559829059829, 
					0.8078632478632478, 
					0.8092521367521367, 
					0.8106517094017094, 
					0.8119123931623932, 
					0.8131410256410256, 
					0.8144230769230769, 
					0.8155448717948718, 
					0.8167735042735043, 
					0.8179594017094017, 
					0.8189529914529915, 
					0.8198397435897435, 
					0.8204807692307692, 
					0.8214957264957264, 
					0.822457264957265, 
					0.8232692307692308, 
					0.8243910256410256, 
					0.8249679487179488, 
					0.8257051282051282, 
					0.8265064102564103, 
					0.8271901709401709, 
					0.8280982905982905, 
					0.8288675213675214, 
					0.8298290598290599, 
					0.8308653846153846, 
					0.831741452991453, 
					0.8327136752136752, 
					0.8339636752136752, 
					0.83491452991453, 
					0.8360149572649572, 
					0.8370726495726496, 
					0.8381837606837607, 
					0.8392735042735042, 
					0.8408760683760684, 
					0.8427457264957265, 
					0.8448504273504274, 
					0.8472970085470085, 
					0.8503525641025641, 
					0.8533653846153846, 
					0.85625, 
					0.8588888888888889, 
					0.8616773504273504, 
					0.8652136752136752, 
					0.8689423076923077, 
					0.873215811965812, 
					0.8781303418803419, 
					0.8828739316239316, 
					0.887724358974359, 
					0.8926175213675214, 
					0.8973290598290599, 
					0.901559829059829, 
					0.905491452991453, 
					0.9097649572649573, 
					0.9137286324786325, 
					0.9177777777777778, 
					0.9212072649572649, 
					0.9241559829059829, 
					0.9273397435897436, 
					0.9301923076923077, 
					0.9334188034188035, 
					0.937275641025641, 
					0.941965811965812, 
					0.9477457264957265, 
					0.9540277777777778, 
					0.9612286324786324, 
					0.9687286324786325, 
					0.9770299145299145, 
					0.9851388888888889, 
					0.991517094017094, 
					0.9955662393162393, 
					0.9979380341880342, 
					0.9992094017094018, 
					0.9997222222222222, 
					0.9998824786324786, 
					0.9999679487179487, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0, 
					1.0  };
					
			int[] R = new int[256]; 	
			int[] G = new int[256];
			int[] B = new int[256]; 
			double[] Histogram_R = new double[256];
			double[] Histogram_G = new double[256];
			double[] Histogram_B = new double[256];
			int width = ip.getWidth();
			int height = ip.getHeight();
			
			for (int v = 0; v < height; v++) {
				for (int u = 0; u < width; u++) {
					color = new Color(ip.getPixel(u, v));
					R[color.getRed()] = R[color.getRed()] + 1;
					G[color.getGreen()] = G[color.getGreen()] + 1;
					B[color.getBlue()] = B[color.getBlue()] + 1;
				}
			}
			
			 for (int i = 0; i < 256; i++) {
				 if(i == 0) {
					 Histogram_R[0] = R[0];
					 Histogram_G[0] = G[0];
					 Histogram_B[0] = B[0];
				}
				 else {
					 Histogram_R[i] = Histogram_R[i - 1] + R[i];
					 Histogram_G[i] = Histogram_G[i - 1] + G[i];
					 Histogram_B[i] = Histogram_B[i - 1] + B[i];
				 	}
		        }
			 
			 for (int i = 0; i < 256; i++) {
				 Histogram_R[i] = Histogram_R[i]/Histogram_R[255];
				 Histogram_G[i] = Histogram_G[i]/Histogram_G[255];
				 Histogram_B[i] = Histogram_B[i]/Histogram_B[255];
		        }
			 
	///////         here is matching
			 
				int[] map_Red = new int[256]; 
				int[] map_Green = new int[256]; 
				int[] map_Blue = new int[256];


				 
				 for (int a = 0; a < 256; a++) {
					 int j = 256 - 1;
					while (j >= 0 && Histogram_R[a] <= Red[j]) {
						map_Red[a] = j;
						 j--;
					};
				 };
				
				for (int b = 0; b < 256; b++) {
					 int t = 256 - 1;
					while (t >= 0 && Histogram_G[b] <= Green[t]) {
						map_Green[b] = t;
						 t--;
					};
				};
					
					for (int c = 0; c < 256; c++) {
						 int p = 256 - 1;
						while (p >= 0 && Histogram_B[c] <= Blue[p]) {
							map_Blue[c] = p;
							 p--;
						};
					};
					
					
	// Drawing
					for (int row = 0; row < height; row++) {
						for (int col = 0; col < width; col++)  {
				                Color c = new Color(ip.getPixel(col, row));
				                int value[] = new int[3];
				                
				                int _R = c.getRed();
				                int _G = c.getGreen();
				                int _B = c.getBlue();
				                
				                value[0] = map_Red[_R];
				                value[1] = map_Green[_G];
				                value[2] = map_Blue[_B];
				                ip.putPixel(col, row, value);
				            }
				        }
					}
	}